window.LORE = { apiBase: "/api", theme: { primary: "#a18cd1", accent: "#ffd1e6" }, onLogin: function(payload){ console.log("login payload", payload); if(payload && payload.role === "admin") window.location = "/admin/"; if(payload && payload.role === "client") window.location = "/"; } }; document.addEventListener('submit', function(e){ if(e.target && e.target.id === 'loginForm'){ e.preventDefault(); const form = e.target; const data = {email: form.email.value.trim(), password: form.password.value}; const btn = form.querySelector('button[type="submit"]'); if(btn) btn.disabled = true; fetch(window.LORE.apiBase + '/login', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data) }).then(async r=>{ const json = await r.json().catch(()=>({message:'Resposta invÃ¡lida'})); if(r.ok && json.token) { localStorage.setItem('token', json.token); window.LORE.onLogin(json.user||{}); } else { alert(json && json.message ? json.message : 'Erro ao logar'); } }).catch(err=>{ console.error(err); alert('Erro de rede'); }).finally(()=>{ if(btn) btn.disabled = false; }); } });